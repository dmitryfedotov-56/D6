# D6

Репозиторий содержит ответ на задание по модулю D6. Сделано следующее.

1. Создана страница “category/” на этой странице пользователь может подписаться на рассылки по темам или отписатться от рассылок. 
Перейти на такую странцу можно с главной страницы, используя кнопку “Подписки”.

2. Когда добавляется новый пост, то пользователь, подписанный на соответствующую тему, получает письмо c кратким содержанием 
и ссылокой на пост.

Примечание. Я столкнулся со следующей проблемой. В тот момент, когда приходит сигнал post_save, пост действительно создан, 
но его связи с категориями не установлены, поле instance.category, имеющее тип ManyToMany еще пусто. 

Я нашел следующее решение: категорию поста я беру прямо из запроса POST. Я переопределил метод post для представления PostCreate. 
Этот метод берет категорию из запроса, затем составляет список пользователей, подписанных на эту категорию для автора, 
создающего пост. Такой список используется при обработке сигнала для рассылки, при этом учитывается только список для автора, 
создающего пост. 
Разумеется, это решение представляет собой “костыль”, но оно работает. В данном варианте для получения письма пользователь должен 
быть подписан на все темы поста. Вероятно, надо использовать другой сигнал, но я его пока не нашел. 
Если есть лучшее решение, пожалуйста, подскажите.

3. Пользователь может получать список всех новых постов по темам, на которые он подписан. Для этого создана команда runapscheduler, добавляющая в список заданий выполнение функции my_job. Такая функция создает объект informer - экземпляр класса UserInformer, для всех пользователей выполняет следующее: вызывает метод informer.new_user_posts, возвращающий список всех новых постов по темам, на которые подписан пользователь, если такой список непуст, вызывает метод informer.send_news_to_user, отправляющий пользвателю письмо со списком ссылок на новые посты. Для проверки работы методов класса сделано следующее: на главной странице имеется кнопка “Новое”, позволяющая пользователю получить список новых постов по темам, на которые пользователь подписан.

4. Пользователь регистрируется через e-mail, производится проверка почты. После успешной регистрации пользователь получает 
приветственное письмо.
